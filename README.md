<img src="https://img.shields.io/github/v/release/guardian/mobile-apps-api-models?label=schema%20version">
<img src="https://img.shields.io/maven-central/v/com.gu/mobile-apps-api-models_2.12?label=scala%202.12">

# Mobile Apps Api Models

These models are used to communicate between MAPI and the native apps.
This repository defines the protobuf [schema](./proto/collection.proto) for "blueprint" collections.

## Linting

[Protolint](https://github.com/yoheimuta/protolint) is used to lint the proto files in this repository.
Protolint follows the official Google [style guide](https://protobuf.dev/programming-guides/style/).

If the proto file isn't linted correctly status checks on a PR will fail.

To fix any lint errors:

```
brew install protolint
protolint -fix ./proto/.
```

## Releases

Use the GitHub UI to generate schema releases.

For Scala, the release process results in a deployment to [Maven](https://repo1.maven.org/maven2/com/gu/mobile-apps-api-models_2.12/).
For android and iOS, the corresponding models will be generated by separate processes (e.g. at build time).

To release via the GitHub UI, visit [this](https://github.com/guardian/mobile-apps-api-models/releases/new) page.
- Create a tag version in the format vX.X.X that represents the version you'd like to release.
  The tag will be created as part of the process so doesn't need to exist before creating a release.
- Define a release title and any useful release notes.
- Ensure the box "Set as pre-release" is _**not**_ checked and the checkbox "Set as the latest release" _**is**_ checked.
- When clicking the "Publish release" button a GitHub workflow will be triggered to generate and publish the Scala models.

<img src="./docs/images/release.png">

## Non-production releases

### Scala

A snapshot (pre-release) version can be released via the GitHub UI.

The steps you should take are:
- Push the branch with the changes you want to release to GitHub.
- [Click here](https://github.com/guardian/mobile-apps-api-models/releases/new?prerelease=true) to create prerelease using GitHub releases. 
You should see a view like this:

<img src="docs/images/pre-release.png">

You must then:
- Set the Target to your branch.
- Create a tag for the snapshot release (the tag will be created as part of the pre-release if it doesn't already exist).
- The tag should ideally have format "vX.X.X-SNAPSHOT" (the workflow will account for a missing `v` or `-SNAPSHOT`).
- Double-check that the "Set as pre-release" box is ticket.
- To automatically release the snapshot to sonatype, click the "Publish release" button.
- You should be able to find the snapshot release [here](https://oss.sonatype.org/content/repositories/snapshots/com/gu/)